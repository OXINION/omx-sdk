<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campaign Module Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      .container {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #007aff;
      }
      button {
        background: #007aff;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 5px;
        transition: all 0.3s ease;
      }
      button:hover {
        background: #0056b3;
        transform: translateY(-2px);
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-sizing: border-box;
      }
      #output {
        background: #1a202c;
        color: #e2e8f0;
        padding: 20px;
        border-radius: 10px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 500px;
        overflow-y: auto;
        margin-top: 20px;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      .full-width {
        grid-column: 1 / -1;
      }
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      .status-connected {
        background-color: #38a169;
      }
      .status-disconnected {
        background-color: #e53e3e;
      }
      .status-pending {
        background-color: #d69e2e;
      }
      .warning-box {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        color: #856404;
      }
      .success-box {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        color: #155724;
      }
      .error-box {
        background: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ Campaign Module Test (No Auth Version)</h1>

      <div class="warning-box">
        <h4>‚ö†Ô∏è Test Guide</h4>
        <p>
          ‚Ä¢ Click <strong>"Initialize Campaign Client"</strong> to get started
        </p>
        <p>‚Ä¢ Directly test database-access function without JWT authentication</p>
        <p>‚Ä¢ Bypass all permissions with SERVICE_ROLE_KEY</p>
      </div>

      <div class="section">
        <h3>üìä Connection Status</h3>
        <p id="connection-status">
          <span
            class="status-indicator status-pending"
            id="status-indicator"
          ></span>
          <span id="status-text">Ready to initialize</span>
        </p>
      </div>

      <div class="section">
        <h3>üîë Authentication</h3>
        <div class="form-grid">
          <div>
            <label for="clientId">Client ID:</label>
            <input
              type="text"
              id="clientId"
              value="8ac9ed2e-7a81-4caf-b2ed-ecb8f025fef9"
            />
          </div>
          <div>
            <label for="secretKey">Secret Key:</label>
            <input
              type="password"
              id="secretKey"
              value="9c5fc630-5304-4b6d-957d-f8767e5fe809"
            />
          </div>
          <div class="full-width">
            <label for="teamId">Team ID (optional):</label>
            <input
              type="text"
              id="teamId"
              placeholder="Leave empty to auto-generate"
            />
          </div>
        </div>
      </div>

      <div class="section">
        <h3>üß™ SDK Actions</h3>
        <button onclick="initializeCampaignClient()">
          Initialize Campaign Client
        </button>
        <button onclick="testAuthentication()" id="authBtn" disabled>
          Test Authentication (Optional)
        </button>
        <button onclick="testDatabaseAccess()" id="dbAccessBtn" disabled>
          Test Database Access (No Auth)
        </button>
        <button onclick="listCampaigns()" id="listBtn" disabled>
          List Campaigns
        </button>
        <button onclick="getCampaignStats()" id="statsBtn" disabled>
          Get Campaign Stats
        </button>
        <button onclick="clearOutput()">Clear Output</button>
      </div>

      <div class="section">
        <h3>‚ûï Create Campaign</h3>
        <div class="form-grid">
          <div>
            <label for="campaignName">Campaign Name: *</label>
            <input
              type="text"
              id="campaignName"
              value="SDK Test Campaign"
              required
            />
          </div>
          <div>
            <label for="campaignIndustry">Industry:</label>
            <select id="campaignIndustry">
              <option value="technology">Technology</option>
              <option value="finance">Finance</option>
              <option value="healthcare">Healthcare</option>
              <option value="education">Education</option>
              <option value="retail">Retail</option>
              <option value="marketing">Marketing</option>
              <option value="ecommerce">E-commerce</option>
            </select>
          </div>
          <div>
            <label for="campaignStatus">Status:</label>
            <select id="campaignStatus">
              <option value="draft">Draft</option>
              <option value="active">Active</option>
              <option value="paused">Paused</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div>
            <label for="campaignTarget">Target Audience:</label>
            <input type="text" id="campaignTarget" value="developers" />
          </div>
          <div>
            <label for="campaignStartDate">Start Date: *</label>
            <input type="datetime-local" id="campaignStartDate" required />
          </div>
          <div>
            <label for="campaignEndDate">End Date:</label>
            <input type="datetime-local" id="campaignEndDate" />
          </div>
          <div>
            <label for="campaignBudget">Budget ($):</label>
            <input
              type="number"
              id="campaignBudget"
              min="0"
              step="0.01"
              placeholder="1000.00"
            />
          </div>
          <div>
            <label for="campaignFrequency">Frequency:</label>
            <select id="campaignFrequency">
              <option value="once">Once</option>
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
          <div>
            <label for="campaignPrimaryGoal">Primary Goal:</label>
            <select id="campaignPrimaryGoal">
              <option value="engagement">Engagement</option>
              <option value="conversion">Conversion</option>
              <option value="awareness">Awareness</option>
              <option value="retention">Retention</option>
            </select>
          </div>
          <div>
            <label for="campaignSuccessMetric">Success Metric:</label>
            <select id="campaignSuccessMetric">
              <option value="open-rate">Open Rate</option>
              <option value="click-rate">Click Rate</option>
              <option value="conversion-rate">Conversion Rate</option>
              <option value="revenue">Revenue</option>
            </select>
          </div>
          <div>
            <label for="campaignFromName">From Name:</label>
            <input
              type="text"
              id="campaignFromName"
              placeholder="Your Company"
            />
          </div>
          <div>
            <label for="campaignFromEmail">From Email:</label>
            <input
              type="email"
              id="campaignFromEmail"
              placeholder="hello@company.com"
            />
          </div>
          <div class="full-width">
            <label for="campaignDescription">Description:</label>
            <textarea id="campaignDescription" rows="3">
Campaign created via OMX SDK test interface</textarea
            >
          </div>
          <div class="full-width">
            <button onclick="createCampaign()" id="createBtn" disabled>
              Create Campaign
            </button>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>üìÑ Test Output</h3>
        <div id="output">Campaign Module Test Ready (No Auth Version)...\n</div>
      </div>
    </div>

    <script>
      let campaignClient = null;
      let authToken = null;
      let currentTeamId = null;

      function log(message, type = "info") {
        const output = document.getElementById("output");
        const timestamp = new Date().toLocaleTimeString();
        const prefix =
          {
            success: "‚úÖ",
            error: "‚ùå",
            warning: "‚ö†Ô∏è",
            info: "‚ÑπÔ∏è",
          }[type] || "‚ÑπÔ∏è";

        output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
        output.scrollTop = output.scrollHeight;
      }

      function updateStatus(status, text) {
        const indicator = document.getElementById("status-indicator");
        const statusText = document.getElementById("status-text");
        indicator.className = `status-indicator status-${status}`;
        statusText.textContent = text;
      }

      function enableButtons() {
        ["authBtn", "listBtn", "statsBtn", "createBtn", "dbAccessBtn"].forEach(
          (id) => {
            document.getElementById(id).disabled = false;
          }
        );
      }

      function clearOutput() {
        document.getElementById("output").textContent = "Output cleared...\n";
      }

      // Campaign Client (No Auth Version)
      class CampaignClient {
        constructor(clientId, secretKey, teamId) {
          this.clientId = clientId;
          this.secretKey = secretKey;
          this.teamId = teamId || null; // Set to null for now
          this.authToken = null;
          this.baseUrl =
            "https://blhilidnsybhfdmwqsrx.supabase.co/functions/v1";
        }

        // UUID generation function
        createUUID() {
          return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(
            /[xy]/g,
            function (c) {
              const r = (Math.random() * 16) | 0;
              const v = c == "x" ? r : (r & 0x3) | 0x8;
              return v.toString(16);
            }
          );
        }

        // Method to find team_id from API keys
        async loadTeamIdFromApiKeys() {
          try {
            log("üîç Loading team_id from API keys...", "info");
            const apiKeys = await this.databaseAccess("api_keys", "business", {
              client_id: this.clientId,
            });

            if (apiKeys.length > 0 && apiKeys[0].team_id) {
              this.teamId = apiKeys[0].team_id;
              log(`üÜî Team ID from API keys: ${this.teamId}`, "success");
            } else {
              log("‚ö†Ô∏è No team_id found in API keys", "warning");
              // Generate UUID as last resort
              this.teamId = this.createUUID();
              log(`üÜî Generated new team_id: ${this.teamId}`, "info");
            }
          } catch (error) {
            log(
              `‚ö†Ô∏è Could not load team_id from API keys: ${error.message}`,
              "warning"
            );
            // Generate UUID as last resort
            this.teamId = this.createUUID();
            log(`üÜî Generated fallback team_id: ${this.teamId}`, "info");
          }
        }

        async authenticate() {
          log("üîê Authenticating with Edge Function...", "info");

          try {
            const response = await fetch(`${this.baseUrl}/create-jwt-token`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization:
                  "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
                apikey:
                  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
              },
              body: JSON.stringify({
                clientId: this.clientId,
                secretKey: this.secretKey,
              }),
            });

            if (!response.ok) {
              const errorText = await response.text();
              log(`üìÑ Error response: ${errorText}`, "error");
              throw new Error(
                `Authentication failed: ${response.status} ${response.statusText}`
              );
            }

            const data = await response.json();
            this.authToken = data.token;
            log("‚úÖ Authentication successful!", "success");
            log(
              `üéüÔ∏è JWT Token received (${this.authToken.length} chars)`,
              "success"
            );

            // Decode JWT token to extract team_id
            try {
              const payload = JSON.parse(atob(this.authToken.split(".")[1]));
              log(
                `üîç Token payload: ${JSON.stringify(payload, null, 2)}`,
                "info"
              );

              // Extract and set team_id from JWT
              if (payload.team_id) {
                this.teamId = payload.team_id;
                log(`üÜî Team ID from JWT: ${this.teamId}`, "success");
              } else if (payload.client_id) {
                // If no team_id, find from API keys
                log(
                  "üîç No team_id in JWT, looking up from API keys...",
                  "info"
                );
                await this.loadTeamIdFromApiKeys();
              }
            } catch (e) {
              log("‚ö†Ô∏è Could not decode JWT payload", "warning");
              // If JWT decoding fails, find from API keys
              await this.loadTeamIdFromApiKeys();
            }

            return this.authToken;
          } catch (error) {
            log(`‚ùå Authentication failed: ${error.message}`, "error");
            throw error;
          }
        }

        // database-access Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÎäî Î©îÏÑúÎìú (No Auth)
        async databaseAccess(
          table = "campaigns",
          schema = "business",
          filters = {}
        ) {
          try {
            let url = `${this.baseUrl}/database-access?table=${table}&schema=${schema}`;
            let method = "GET";
            let body = null;

            // ÌïÑÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ POSTÎ°ú Ï†ÑÎã¨
            if (Object.keys(filters).length > 0) {
              method = "POST";
              body = JSON.stringify({ filters });
            }

            log(
              `üì° Calling database-access (NO AUTH): ${method} ${url}`,
              "info"
            );
            if (body) {
              log(`üìù Request body: ${body}`, "info");
            }

            // Authorization Ìó§ÎçîÏóê apikey ÏÇ¨Ïö© (Supabase ÌîåÎû´Ìèº Ïö∞Ìöå)
            const headers = {
              "Content-Type": "application/json",
              Authorization:
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
              apikey:
                "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
            };

            log("üîë Using apikey as Authorization header", "info");

            const response = await fetch(url, {
              method: method,
              headers: headers,
              body: body,
            });

            log(
              `üìä database-access response: ${response.status} ${response.statusText}`,
              response.ok ? "success" : "warning"
            );

            const responseText = await response.text();
            log(
              `üìÑ Response preview: ${responseText.substring(0, 300)}...`,
              "info"
            );

            if (response.ok) {
              try {
                const result = JSON.parse(responseText);
                log(`‚úÖ database-access successful`, "success");
                log(
                  `üìä Retrieved ${result.count || 0} records from ${result.schema || schema}.${result.table || table}`,
                  "success"
                );

                if (result.key_type) {
                  log(`üîê Key type used: ${result.key_type}`, "info");
                }

                return result.data || [];
              } catch (parseError) {
                log(`‚ùå Failed to parse JSON: ${parseError.message}`, "error");
                throw new Error(
                  `Invalid JSON response: ${responseText.substring(0, 100)}`
                );
              }
            } else {
              log(`üìÑ database-access error: ${responseText}`, "error");
              throw new Error(`database-access failed: ${response.status}`);
            }
          } catch (error) {
            log(`‚ö†Ô∏è database-access failed: ${error.message}`, "warning");
            log("üìù Falling back to mock data", "info");
            return this.getMockCampaigns();
          }
        }

        // Ï∫†ÌéòÏù∏ ÏÉùÏÑ± (database-access ÏÇ¨Ïö©)
        async createCampaignViaDatabaseAccess(campaignData) {
          try {
            log("‚ûï Creating campaign via database-access...", "info");

            const url = `${this.baseUrl}/database-access?table=campaigns&schema=business`;

            const requestBody = {
              action: "create",
              data: {
                ...campaignData,
                team_id: this.teamId,
                created_at: new Date().toISOString(),
              },
            };

            log(
              `üìù Sending create request: ${JSON.stringify(requestBody, null, 2)}`,
              "info"
            );

            const response = await fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                // Supabase anon key for basic authentication
                Authorization:
                  "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
                apikey:
                  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsaGlsaWRuc3liaGZkbXdxc3J4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ1MjM4OTgsImV4cCI6MjA2MDA5OTg5OH0.KZGJMcm2V7aW1tH7U0skvipE7h53212MRaaSm2kS84c",
              },
              body: JSON.stringify(requestBody),
            });

            const responseText = await response.text();
            log(`üìÑ Create response: ${responseText}`, "info");

            if (response.ok) {
              const result = JSON.parse(responseText);

              if (result.success) {
                log("‚úÖ Campaign created via database-access", "success");
                return result.data;
              } else {
                log(
                  `‚ö†Ô∏è Database-access returned error: ${result.error}`,
                  "warning"
                );
                throw new Error(result.error || "Database creation failed");
              }
            } else {
              log(
                `üìÑ HTTP error: ${response.status} ${response.statusText}`,
                "error"
              );
              throw new Error(`HTTP ${response.status}: ${responseText}`);
            }
          } catch (error) {
            log(`‚ö†Ô∏è Campaign creation failed: ${error.message}`, "warning");
            log("üìù Returning mock data", "info");

            // Mock Îç∞Ïù¥ÌÑ∞ Î∞òÌôò
            return {
              id: `campaign-${Date.now()}`,
              ...campaignData,
              team_id: this.teamId,
              created_at: new Date().toISOString(),
              mock: true,
            };
          }
        }

        getMockCampaigns() {
          return [
            {
              id: "mock-campaign-1",
              name: "Summer Sale Campaign",
              status: "active",
              industry: "retail",
              target: "shoppers",
              team_id: this.teamId,
              created_at: "2024-07-01T00:00:00Z",
              description: "Summer promotion campaign",
            },
            {
              id: "mock-campaign-2",
              name: "Tech Conference 2024",
              status: "draft",
              industry: "technology",
              target: "developers",
              team_id: this.teamId,
              created_at: "2024-07-15T00:00:00Z",
              description: "Annual tech conference promotion",
            },
            {
              id: "mock-campaign-3",
              name: "Healthcare Innovation",
              status: "paused",
              industry: "healthcare",
              target: "medical professionals",
              team_id: this.teamId,
              created_at: "2024-06-20T00:00:00Z",
              description: "Healthcare innovation awareness",
            },
          ];
        }

        async listCampaigns() {
          return this.databaseAccess("campaigns", "business", {
            team_id: this.teamId,
          });
        }

        async createCampaign(data) {
          return this.createCampaignViaDatabaseAccess(data);
        }

        async getCampaignStats() {
          const campaigns = await this.listCampaigns();

          return {
            totalCampaigns: campaigns.length,
            activeCampaigns: campaigns.filter((c) => c.status === "active")
              .length,
            draftCampaigns: campaigns.filter((c) => c.status === "draft")
              .length,
            pausedCampaigns: campaigns.filter((c) => c.status === "paused")
              .length,
            completedCampaigns: campaigns.filter(
              (c) => c.status === "completed"
            ).length,
            teamId: this.teamId,
          };
        }
      }

      // Global functions
      window.initializeCampaignClient = function () {
        const clientId = document.getElementById("clientId").value.trim();
        const secretKey = document.getElementById("secretKey").value.trim();
        const teamId = document.getElementById("teamId").value.trim();

        if (!clientId || !secretKey) {
          log("‚ùå Please enter both clientId and secretKey", "error");
          return;
        }

        try {
          log("üöÄ Initializing Campaign Client (No Auth Version)...", "info");
          log(`üìã Client ID: ${clientId}`, "info");
          log(`üîë Secret Key: ${secretKey.substring(0, 8)}...`, "info");
          updateStatus("pending", "Initializing...");

          campaignClient = new CampaignClient(clientId, secretKey, teamId);
          currentTeamId = campaignClient.teamId;

          log("‚úÖ Campaign Client initialized successfully!", "success");
          log(`üìã Team ID: ${currentTeamId}`, "info");
          log("üîó Client configured to use database-access (no auth)", "info");

          updateStatus("connected", "Campaign Client Ready");
          enableButtons();
        } catch (error) {
          log(
            `‚ùå Failed to initialize Campaign Client: ${error.message}`,
            "error"
          );
          updateStatus("disconnected", "Initialization Failed");
        }
      };

      window.testAuthentication = async function () {
        if (!campaignClient) {
          log("‚ùå Campaign client not initialized", "error");
          return;
        }

        try {
          const token = await campaignClient.authenticate();
          log("‚úÖ Authentication test successful!", "success");
          log(`üéüÔ∏è Token preview: ${token.substring(0, 50)}...`, "info");
          authToken = token;
        } catch (error) {
          log(`‚ùå Authentication test failed: ${error.message}`, "error");
        }
      };

      window.testDatabaseAccess = async function () {
        if (!campaignClient) {
          log("‚ùå Campaign client not initialized", "error");
          return;
        }

        try {
          log("üîç Testing database-access function (NO AUTH)...", "info");

          // API ÌÇ§ ÌÖåÏù¥Î∏î Ï°∞Ìöå ÌÖåÏä§Ìä∏
          const apiKeys = await campaignClient.databaseAccess(
            "api_keys",
            "business"
          );
          log(`‚úÖ API Keys found: ${apiKeys.length}`, "success");
          if (apiKeys.length > 0) {
            log(
              `üìä First API key: ${JSON.stringify(apiKeys[0], null, 2)}`,
              "info"
            );
          }

          // Ï∫†ÌéòÏù∏ ÌÖåÏù¥Î∏î Ï°∞Ìöå ÌÖåÏä§Ìä∏
          const campaigns = await campaignClient.databaseAccess(
            "campaigns",
            "business"
          );
          log(`‚úÖ Campaigns found: ${campaigns.length}`, "success");
          if (campaigns.length > 0) {
            log(
              `üìä First campaign: ${JSON.stringify(campaigns[0], null, 2)}`,
              "info"
            );
          }
        } catch (error) {
          log(`‚ùå Database access test failed: ${error.message}`, "error");
        }
      };

      window.listCampaigns = async function () {
        if (!campaignClient) {
          log("‚ùå Campaign client not initialized", "error");
          return;
        }

        try {
          log("üìã Fetching campaigns via database-access (no auth)...", "info");
          const campaigns = await campaignClient.listCampaigns();
          log(`‚úÖ Found ${campaigns.length} campaigns`, "success");

          campaigns.forEach((campaign, index) => {
            log(
              `  ${index + 1}. ${campaign.name} (${campaign.status}) - ${campaign.industry || "N/A"}`,
              "info"
            );
            if (campaign.target) {
              log(`     Target: ${campaign.target}`, "info");
            }
            if (campaign.description) {
              log(`     Description: ${campaign.description}`, "info");
            }
          });

          if (campaigns.length === 0) {
            log("‚ÑπÔ∏è No campaigns found", "info");
          }
        } catch (error) {
          log(`‚ùå Failed to list campaigns: ${error.message}`, "error");
        }
      };

      window.getCampaignStats = async function () {
        if (!campaignClient) {
          log("‚ùå Campaign client not initialized", "error");
          return;
        }

        try {
          log("üìä Fetching campaign statistics...", "info");
          const stats = await campaignClient.getCampaignStats();
          log("‚úÖ Campaign stats retrieved:", "success");
          log(`  üìà Total: ${stats.totalCampaigns}`, "info");
          log(`  üü¢ Active: ${stats.activeCampaigns}`, "info");
          log(`  üìù Draft: ${stats.draftCampaigns}`, "info");
          if (stats.pausedCampaigns) {
            log(`  ‚è∏Ô∏è Paused: ${stats.pausedCampaigns}`, "info");
          }
          log(`  ‚úÖ Completed: ${stats.completedCampaigns}`, "info");
        } catch (error) {
          log(`‚ùå Failed to get campaign stats: ${error.message}`, "error");
        }
      };

      window.createCampaign = async function () {
        if (!campaignClient) {
          log("‚ùå Campaign client not initialized", "error");
          return;
        }

        try {
          // ÌïÑÏàò ÌïÑÎìú Í≤ÄÏ¶ù
          const name = document.getElementById("campaignName").value.trim();
          const startDate = document.getElementById("campaignStartDate").value;

          if (!name) {
            log("‚ùå Please enter a campaign name", "error");
            return;
          }

          if (!startDate) {
            log("‚ùå Please select a start date", "error");
            return;
          }

          const campaignData = {
            name: name,
            description: document
              .getElementById("campaignDescription")
              .value.trim(),
            industry: document.getElementById("campaignIndustry").value,
            status: document.getElementById("campaignStatus").value,
            target: document.getElementById("campaignTarget").value.trim(),
            start_date: new Date(startDate).toISOString(),
            end_date: document.getElementById("campaignEndDate").value
              ? new Date(
                  document.getElementById("campaignEndDate").value
                ).toISOString()
              : null,
            budget: document.getElementById("campaignBudget").value
              ? parseFloat(document.getElementById("campaignBudget").value)
              : null,
            frequency: document.getElementById("campaignFrequency").value,
            primary_goal: document.getElementById("campaignPrimaryGoal").value,
            success_metric: document.getElementById("campaignSuccessMetric")
              .value,
            from_name:
              document.getElementById("campaignFromName").value.trim() || null,
            from_email:
              document.getElementById("campaignFromEmail").value.trim() || null,
            team_id: campaignClient.teamId,
            is_public: false,
            target_audience: document
              .getElementById("campaignTarget")
              .value.trim()
              ? JSON.stringify({
                  primary: document
                    .getElementById("campaignTarget")
                    .value.trim(),
                })
              : null,
          };

          log("‚ûï Creating campaign with full data...", "info");
          log(`üìù Campaign data:`, "info");
          log(`   Name: ${campaignData.name}`, "info");
          log(`   Industry: ${campaignData.industry}`, "info");
          log(`   Status: ${campaignData.status}`, "info");
          log(`   Start Date: ${campaignData.start_date}`, "info");
          log(`   Budget: ${campaignData.budget || "Not set"}`, "info");
          log(`   Target: ${campaignData.target}`, "info");
          log(`   Description: ${campaignData.description}`, "info");

          const result = await campaignClient.createCampaign(campaignData);
          log("‚úÖ Campaign created successfully!", "success");
          log(
            `üìä Created campaign ID: ${result.id || result[0]?.id}`,
            "success"
          );

          if (result.mock) {
            log("üìù Note: This was created as mock data", "warning");
          } else {
            log("üéâ Real campaign created in database!", "success");
          }
        } catch (error) {
          log(`‚ùå Failed to create campaign: ${error.message}`, "error");
        }
      };

      // Initialize
      log("üåê Campaign Module Test Ready (No Auth Version)", "info");
      log(
        'üìã Enter your credentials and click "Initialize Campaign Client"',
        "info"
      );
      log("üí° This version bypasses JWT authentication", "info");

      // Í∏∞Î≥∏ ÏãúÏûë ÎÇ†Ïßú ÏÑ§Ï†ï (ÎÇ¥Ïùº)
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      tomorrow.setHours(10, 0, 0, 0); // Ïò§Ï†Ñ 10Ïãú

      const tomorrowString = tomorrow.toISOString().slice(0, 16); // YYYY-MM-DDTHH:MM ÌòïÏãù
      document.getElementById("campaignStartDate").value = tomorrowString;

      log(`üìÖ Default start date set to: ${tomorrowString}`, "info");
    </script>
  </body>
</html>
